name: deploy-web

on:
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: brndnmtthws/rust-action@v1
        with:
          toolchain: nightly
      - name: Add wasm target
        run: rustup target add wasm32-unknown-unknown
      - name: Install wasm-bindgen-cli
        run: cargo install wasm-bindgen-cli --version 0.2.95 --locked
      - name: Build wasm demo
        run: >
          cargo build -p bevy_burn_human
          --release
          --target wasm32-unknown-unknown
          --no-default-features
          --features web
      - name: Run wasm-bindgen
        run: >
          wasm-bindgen --target web
          --out-dir crates/bevy_burn_human/www/pkg
          target/wasm32-unknown-unknown/release/bevy_burn_human.wasm
      - name: Copy assets
        run: |
          mkdir -p crates/bevy_burn_human/www/assets
          if compgen -G "assets/*" > /dev/null; then
            cp -r assets/* crates/bevy_burn_human/www/assets/
          fi
      - name: Deploy to gh-pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: www
          publish_dir: crates/bevy_burn_human/www
